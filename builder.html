<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="builder.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="sage/sage.css">
    <script type="text/javascript" src="sage/sage.js"></script>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    
    <title>SAGE builder</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
	<div class="SAGE_chart_collection">
		<div class="button-column">
			<button id="overlayButton" aria-label="Insert Overlay"></button>
			<button id="tableButton" aria-label="Insert Table"></button>
			<button id="canvasButton" aria-label="Insert Canvas"></button>
		</div>
    
        <div class="editor-holder">
			<select id="exampleSelector"></select>
			<textarea id="jsonEditor" name="jsonEditor"></textarea>
        </div>

        <button id="buildButton" aria-label="Build Chart"></button>

        <div class="chart-holder">
            <div id="mySAGEChart" class="SAGE_chart"></div>
        </div>
    </div>

    <script>
	document.addEventListener('DOMContentLoaded', (event) => {
		const jsonEditor = CodeMirror.fromTextArea(document.getElementById('jsonEditor'), {
			mode: "application/json",
			lineNumbers: true,
			matchBrackets: true,
			autoCloseBrackets: true,
			theme: "default"
		});

        //init drop-down list with exampleSelector
        const examples = {
            "Scatter plot 2D": '{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Properties":{"Points":{"Size":22}},"ChartType":"Scatter plot 2D","Color":{"Name":"Type","Source":{"Categories":["Small","Sporty","Compact","Medium","Large","Van"],"Values":"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5"},"Id":"Type"},"Shape":"Type","X":{"Name":"Mileage","Source":",,,33,33,37,,,32,,32,26,,33,28,25,34,29,35,,,26,,20,,27,,,,19,30,,,33,27,,,,24,,,26,,28,,,,,27,,,23,26,,25,,24,26,24,,25,21,21,23,24,,,23,27,23,20,,,21,,,,,22,22,,22,,22,23,23,,,,,21,,22,21,21,,,,23,,,23,,,18,20,,,18,,18,18,19,20,20,19,"},"Y":{"Name":"Price","Source":"11950,6851,6995,8895,7402,6319,6695,10125,6635,5899,6599,8672,5899,7399,7254,9599,5866,8748,6488,7225,8695,9995,10995,11545,31979,9745,12895,12995,9456,12164,11470,14726,10390,9410,13945,13800,12279,17880,13249,27900,12249,10855,41990,13071,12268,22860,17900,9995,18900,23990,24650,10565,10320,8620,10945,8845,9483,12145,12459,31600,10989,17879,11650,9995,15930,16995,26945,11499,11588,18450,24760,26900,33200,13150,23040,28855,12140,25495,12495,16342,12995,15350,12640,13195,14980,9999,38000,35000,29422,29246,23300,39950,17899,13150,14495,19945,25995,23550,21498,21700,20225,16145,27400,26960,14525,17257,27986,13790,13995,11995,15395,12267,14944,14929,13949,14799,14080"}}',
            "Lines": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Properties":{"Lines":{"Line":{"Style":"Dash","Scale":4}}},"ChartType":"Lines","CheckBoxFilter":"ColorVarId","Color":"ColorVarId","X":"XVarId","Y":"YVarId"},"Data":[{"Name":"X","Source":{"Formatter":{"Type":"CompactTimeFormatter"},"Values":"2410.13916015625,2411.571044921875,2409.270263671875,2413.79052734375,2409.946533203125,2412.364013671875,2411.175537109375,2409.604248046875,2413.190673828125,2410.408203125,2414.421630859375,2411.731201171875,2409.4638671875,2413.051025390625,2410.046630859375,2413.83935546875,2413.00146484375,2414.030029296875,2411.230224609375,2413.487060546875,2411.67724609375,2410.474365234375,2412.29296875,2415.12353515625,2412.0068359375,2415.90283203125,2415.694580078125,2413.08740234375,2408.146240234375,2413.2255859375,2413.036865234375,2412.60986328125,2412.892333984375,2409.743408203125,2414.0615234375,2412.81103515625,2412.6826171875,2410.147216796875,2411.65185546875,2415.703125,2412.593994140625,2415.5185546875,2414.829833984375,2409.18798828125,2413.345947265625,2412.33056640625,2411.7607421875,2412.05810546875,2410.296875,2415.445556640625,2414.748046875,2412.9970703125,2412.447021484375,2413.117431640625,2415.237060546875,2409.57861328125,2413.43701171875,2411.990966796875,2412.813232421875,2415.26806640625,2412.546875,2410.10009765625,2412.203125,2408.419189453125,2411.698974609375,2411.870849609375,2412.273681640625,2411.279296875,2412.455810546875,2413.119384765625,2411.032470703125,2412.984130859375,2413.01953125,2410.052978515625,2412.62744140625,2412.561279296875,2411.23388671875,2412.26806640625,2414.347900390625,2413.927490234375,2413.583251953125,2415.753662109375,2409.623291015625,2412.892333984375,2412.192138671875,2411.8876953125,2413.02294921875,2412.15380859375,2407.825927734375,2412.43994140625,2411.2578125,2412.302001953125,2408.890869140625,2410.570068359375,2412.18017578125,2410.8173828125,2412.433349609375,2411.82861328125,2411.781005859375,2411.06982421875"},"Id":"XVarId","Type":"Trivial"},{"Name":"Y","Source":"0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.46281933784484863,0.6358867287635803,0.5063204169273376,0.3760460317134857,0.6182591915130615,0.5088015794754028,0.505258321762085,0.5111819505691528,0.46288037300109863,0.4765220582485199,0.5927671194076538,0.3566057085990906,0.569875180721283,0.35384687781333923,0.35959959030151367,0.5634571313858032,0.5850672721862793,0.46569713950157166,0.5441938042640686,0.46799516677856445,0.5769706964492798,0.2971770167350769,0.6825982928276062,0.4416424334049225,0.3867000639438629,0.6435468792915344,0.5585406422615051,0.5409863591194153,0.4781029224395752,0.2601916790008545,0.5534135103225708,0.4577440619468689,0.4876247048377991,0.4126926362514496,0.5962645411491394,0.46882233023643494,0.6743828058242798,0.6267830729484558,0.5137699842453003,0.48627275228500366,0.37014374136924744,0.43829160928726196,0.4803094267845154,0.8072909116744995,0.3293496370315552,0.44329357147216797,0.46786707639694214,0.4642292559146881,0.6790948510169983,0.6479750871658325,0.5961272120475769,0.4746238589286804,0.36909088492393494,0.5186559557914734,0.5823938250541687,0.3911283016204834,0.6217871904373169,0.33185824751853943,0.49166232347488403,0.6515976190567017,0.5822046995162964,0.32423168420791626,0.48655349016189575,0.4289986491203308,0.46805325150489807,0.7426130175590515,0.5773766040802002,0.4814813733100891,0.5197180509567261,0.49393296241760254,0.5720511674880981,0.5023376941680908,0.45022130012512207,0.5953459143638611,0.426203191280365,0.5700246691703796,0.495242178440094,0.5241249203681946,0.49308452010154724,0.2981474995613098","Id":"YVarId","Type":"Trivial"},{"Name":"Color","Source":{"Categories":["category1","category2","category3","category4","category5"],"Values":"3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,0,1,2,3,1,0,0,3,1,0,0,2,2,2,1,2,1,2,3,3,3,2,2,4,2,1,3,1,4,4,4,0,3,4,4,1,1,4,4,1,3,2,2,4,2,1,3,2,2,3,3,3,0,2,2,0,1,4,3,2,4,4,4,1,4,2,3,0,3,3,0,4,3,1,4,0,4,0"},"Id":"ColorVarId","Type":"Trivial"}]}',
            "Histogram": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Properties":{"Histogram":{"Contour":{"Color":"black","Opacity":0.40000000000000002}},"TargetAxis":{"Caption":{"Show":true,"Color":"green"}}},"ChartType":"Histogram","CheckBoxFilter":"ColorVarId","Color":"ColorVarId","Target":"XVarId","Text":"ColorVarId"},"Data":[{"Name":"X","Source":"0.4119449257850647,0.48356276750564575,0.3684926927089691,0.594528079032898,0.40232858061790466,0.5232154130935669,0.4637775421142578,0.3852077126502991,0.5645252466201782,0.4254158139228821,0.6260811686515808,0.49155861139297485,0.378197580575943,0.5575579404830933,0.40733060240745544,0.5969787240028381,0.5550615191459656,0.6065064668655396,0.46652427315711975,0.5793541669845581,0.5,0.6,0.7,0.8,0.9,0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.1,0.2,0.3,0.4,0.5","Id":"XVarId","Type":"Trivial"},{"Name":"Color","Source":{"Categories":["category1","category2","category3","category4","category5"],"Values":"3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,1,1,1,3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,1,1,1"},"Id":"ColorVarId","Type":"Trivial"}]}',
            "Color map": '{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Properties":{"XAxis":{"Labels":{"Color":"orange"},"TickMark":{"Show":true},"Minor":{"NumberOfTicks":1,"Grid":{"Style":"Dash"}},"StepCalculation":{"RelativeIncrement":0.10000000000000001}}},"ChartType":"Color map","Color":{"Name":"Z","Source":"11550,6551,6965,7895,7492,6379,6095,17125,5635,9899,1599,6672,5899,7399,7254,9599,5866,8748,6488,7225,8695,9995,10995,11545,31979,9745,12895,12995,9456,12164,11470,14726,10390,9410,13945,13800,12279,17880,13249,27900,12249,10855,41990,13071,12268,22860,17900,9995,18900,23990,24650,10565,10320,8620,10945,8845,9483,12145,12459,31600,10989,17879,11650,9995,15930,16995,26945,11499,11588,18450,24760,26900,33200,13150,23040,28855,12140,25495,12495,16342,12995,15350,12640,13195,14980,9999,38000,35000,29422,29246,23300,39950,17899,13150,14495,19945,25995,23550,21498,21700,20225,16145,27400,26960,14525,17257,27986,13990,16995,11995,25395,12267,18944,14629,18949,14799,18080"},"X":{"Name":"Mileage","Source":",,,33,33,37,,,32,,32,26,,33,28,25,34,29,35,,,26,,20,,27,,,,19,30,,,33,27,,,,24,,,26,,28,,,,,27,,,23,26,,25,,24,26,24,,25,21,21,23,24,,,23,27,23,20,,,21,,,,,22,22,,22,,22,23,23,,,,,21,,22,21,21,,,,23,,,23,,,18,20,,,18,,18,18,19,20,20,19,"},"Y":{"Name":"Price","Source":"11950,6851,6995,8895,7402,6319,6695,10125,6635,5899,6599,8672,5899,7399,7254,9599,5866,8748,6488,7225,8695,9995,10995,11545,31979,9745,12895,12995,9456,12164,11470,14726,10390,9410,13945,13800,12279,17880,13249,7900,12249,10855,1990,13071,12268,12860,17900,9995,18900,13990,14650,10565,10320,8620,10945,8845,9483,12145,12459,31600,10989,17879,11650,9995,15930,16995,26945,11499,11588,18450,24760,26900,33200,13150,23040,28855,12140,25495,12495,16342,12995,15350,12640,13195,14980,9999,38000,35000,29422,29246,23300,39950,17899,13150,14495,19945,25995,23550,21498,21700,20225,16145,27400,26960,14525,17257,17986,13790,13995,11995,15395,12267,14944,14929,13949,14799,14080"}}',
            "Hexagon map": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Properties":{"Hexagon":{"HexagonSize":{"Weight":false,"Size":0.95},"Tessellation":{"RelativeSize":0.1},"Contour":{"Opacity":1}}},"ChartType":"Hexagon map","Color":"X_id","X":"X_id","Y":"Y_id","Text":{"Variables":["X_id","Y_id","Color_id"]}},"Data":[{"Name":"X","Source":"0.4119449257850647,0.48356276750564575,0.3684926927089691,0.594528079032898,0.40232858061790466,0.5232154130935669,0.4637775421142578,0.3852077126502991,0.5645252466201782,0.4254158139228821,0.6260811686515808,0.49155861139297485,0.378197580575943,0.5575579404830933,0.40733060240745544,0.5969787240028381,0.5550615191459656,0.6065064668655396,0.46652427315711975,0.5793541669845581,0.48885464668273926,0.428705632686615,0.5196386575698853,0.6611652374267578,0.505337655544281,0.7001373171806335,0.6897305250167847,0.5593646168708801,0.3123142123222351,0.5662800669670105,0.5568345785140991,0.5354838967323303,0.5496291518211365,0.39215975999832153,0.608087420463562,0.5455549955368042,0.5391278266906738,0.41234779357910156,0.48759111762046814,0.6901668310165405,0.5347056984901428,0.6809350252151489,0.6465102434158325,0.3643909692764282,0.5722953081130981,0.5215216279029846,0.4930357038974762,0.5079043507575989,0.41984620690345764,0.6772727966308594,0.6424053907394409,0.5548569560050964,0.527356743812561,0.5608721971511841,0.6668416261672974,0.38392892479896545,0.5768424868583679,0.5045289397239685,0.5456556081771851,0.6683980226516724,0.532340407371521,0.40999478101730347,0.5151494145393372,0.32595595717430115,0.48995327949523926,0.4985350966453552,0.5186834335327148,0.4689626693725586,0.527777910232544,0.5609790086746216,0.45661482214927673,0.5542131662368774,0.5559648275375366,0.4076387882232666,0.5363749861717224,0.5330515503883362,0.46669211983680725,0.5184118151664734,0.6224005222320557,0.6013733148574829,0.5841609239578247,0.6926907896995544,0.3861537575721741,0.5496047735214233,0.5146030783653259,0.4993927478790283,0.5561448931694031,0.5126926898956299,0.29628896713256836,0.5269966721534729,0.46790066361427307,0.5201025009155273,0.3495437502861023,0.43350014090538025,0.5139988660812378,0.44585713744163513,0.5266731977462769,0.4964262843132019,0.4940336346626282,0.4584948420524597","Id":"X_id","Type":"Trivial"},{"Name":"Y","Source":"0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.46281933784484863,0.6358867287635803,0.5063204169273376,0.3760460317134857,0.6182591915130615,0.5088015794754028,0.505258321762085,0.5111819505691528,0.46288037300109863,0.4765220582485199,0.5927671194076538,0.3566057085990906,0.569875180721283,0.35384687781333923,0.35959959030151367,0.5634571313858032,0.5850672721862793,0.46569713950157166,0.5441938042640686,0.46799516677856445,0.5769706964492798,0.2971770167350769,0.6825982928276062,0.4416424334049225,0.3867000639438629,0.6435468792915344,0.5585406422615051,0.5409863591194153,0.4781029224395752,0.2601916790008545,0.5534135103225708,0.4577440619468689,0.4876247048377991,0.4126926362514496,0.5962645411491394,0.46882233023643494,0.6743828058242798,0.6267830729484558,0.5137699842453003,0.48627275228500366,0.37014374136924744,0.43829160928726196,0.4803094267845154,0.8072909116744995,0.3293496370315552,0.44329357147216797,0.46786707639694214,0.4642292559146881,0.6790948510169983,0.6479750871658325,0.5961272120475769,0.4746238589286804,0.36909088492393494,0.5186559557914734,0.5823938250541687,0.3911283016204834,0.6217871904373169,0.33185824751853943,0.49166232347488403,0.6515976190567017,0.5822046995162964,0.32423168420791626,0.48655349016189575,0.4289986491203308,0.46805325150489807,0.7426130175590515,0.5773766040802002,0.4814813733100891,0.5197180509567261,0.49393296241760254,0.5720511674880981,0.5023376941680908,0.45022130012512207,0.5953459143638611,0.426203191280365,0.5700246691703796,0.495242178440094,0.5241249203681946,0.49308452010154724,0.2981474995613098","Id":"Y_id","Type":"Trivial"},{"Name":"Color","Source":{"Categories":["category1","category2","category3","category4","category5"],"Values":"3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,0,1,2,3,1,0,0,3,1,0,0,2,2,2,1,2,1,2,3,3,3,2,2,4,2,1,3,1,4,4,4,0,3,4,4,1,1,4,4,1,3,2,2,4,2,1,3,2,2,3,3,3,0,2,2,0,1,4,3,2,4,4,4,1,4,2,3,0,3,3,0,4,3,1,4,0,4,0"},"Id":"Color_id","Type":"Trivial"}]}',
            "Overlay (points + pie chart + b-spline)": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Layers":[{"ChartType":"Scatter plot 2D","Color":"ColorId","X":"XId","Y":"YId"},{"ChartType":"Bubble plot","Color":"ColorId","X":"XId","Y":"YId","Properties":{"BinAggregation":{"Aggregate":true},"Bubble":{"CombinationType":"Pie","InternalRadius":0.5,"Contour":{"Opacity":0.59999999999999998},"Filling":{"Opacity":1}}}},{"ChartType":"B-Spline fitting line","X":"XId","Y":"YId"}]},"Data":[{"Name":"X","Source":"0.4119449257850647,0.48356276750564575,0.3684926927089691,0.594528079032898,0.40232858061790466,0.5232154130935669,0.4637775421142578,0.3852077126502991,0.5645252466201782,0.4254158139228821,0.6260811686515808,0.49155861139297485,0.378197580575943,0.5575579404830933,0.40733060240745544,0.5969787240028381,0.5550615191459656,0.6065064668655396,0.46652427315711975,0.5793541669845581,0.48885464668273926,0.428705632686615,0.5196386575698853,0.6611652374267578,0.505337655544281,0.7001373171806335,0.6897305250167847,0.5593646168708801,0.3123142123222351,0.5662800669670105,0.5568345785140991,0.5354838967323303,0.5496291518211365,0.39215975999832153,0.608087420463562,0.5455549955368042,0.5391278266906738,0.41234779357910156,0.48759111762046814,0.6901668310165405,0.5347056984901428,0.6809350252151489,0.6465102434158325,0.3643909692764282,0.5722953081130981,0.5215216279029846,0.4930357038974762,0.5079043507575989,0.41984620690345764,0.6772727966308594,0.6424053907394409,0.5548569560050964,0.527356743812561,0.5608721971511841,0.6668416261672974,0.38392892479896545,0.5768424868583679,0.5045289397239685,0.5456556081771851,0.6683980226516724,0.532340407371521,0.40999478101730347,0.5151494145393372,0.32595595717430115,0.48995327949523926,0.4985350966453552,0.5186834335327148,0.4689626693725586,0.527777910232544,0.5609790086746216,0.45661482214927673,0.5542131662368774,0.5559648275375366,0.4076387882232666,0.5363749861717224,0.5330515503883362,0.46669211983680725,0.5184118151664734,0.6224005222320557,0.6013733148574829,0.5841609239578247,0.6926907896995544,0.3861537575721741,0.5496047735214233,0.5146030783653259,0.4993927478790283,0.5561448931694031,0.5126926898956299,0.29628896713256836,0.5269966721534729,0.46790066361427307,0.5201025009155273,0.3495437502861023,0.43350014090538025,0.5139988660812378,0.44585713744163513,0.5266731977462769,0.4964262843132019,0.4940336346626282,0.4584948420524597","Id":"XId","Type":"Trivial"},{"Name":"Y","Source":"0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.46281933784484863,0.6358867287635803,0.5063204169273376,0.3760460317134857,0.6182591915130615,0.5088015794754028,0.505258321762085,0.5111819505691528,0.46288037300109863,0.4765220582485199,0.5927671194076538,0.3566057085990906,0.569875180721283,0.35384687781333923,0.35959959030151367,0.5634571313858032,0.5850672721862793,0.46569713950157166,0.5441938042640686,0.46799516677856445,0.5769706964492798,0.2971770167350769,0.6825982928276062,0.4416424334049225,0.3867000639438629,0.6435468792915344,0.5585406422615051,0.5409863591194153,0.4781029224395752,0.2601916790008545,0.5534135103225708,0.4577440619468689,0.4876247048377991,0.4126926362514496,0.5962645411491394,0.46882233023643494,0.6743828058242798,0.6267830729484558,0.5137699842453003,0.48627275228500366,0.37014374136924744,0.43829160928726196,0.4803094267845154,0.8072909116744995,0.3293496370315552,0.44329357147216797,0.46786707639694214,0.4642292559146881,0.6790948510169983,0.6479750871658325,0.5961272120475769,0.4746238589286804,0.36909088492393494,0.5186559557914734,0.5823938250541687,0.3911283016204834,0.6217871904373169,0.33185824751853943,0.49166232347488403,0.6515976190567017,0.5822046995162964,0.32423168420791626,0.48655349016189575,0.4289986491203308,0.46805325150489807,0.7426130175590515,0.5773766040802002,0.4814813733100891,0.5197180509567261,0.49393296241760254,0.5720511674880981,0.5023376941680908,0.45022130012512207,0.5953459143638611,0.426203191280365,0.5700246691703796,0.495242178440094,0.5241249203681946,0.49308452010154724,0.2981474995613098","Id":"YId","Type":"Trivial"},{"Name":"Color","Source":{"Categories":["category1","category2","category3","category4","category5"],"Values":"3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,0,1,2,3,1,0,0,3,1,0,0,2,2,2,1,2,1,2,3,3,3,2,2,4,2,1,3,1,4,4,4,0,3,4,4,1,1,4,4,1,3,2,2,4,2,1,3,2,2,3,3,3,0,2,2,0,1,4,3,2,4,4,4,1,4,2,3,0,3,3,0,4,3,1,4,0,4,0"},"Id":"ColorId","Type":"Trivial"}]}',
            "Table (boxplot + violin)": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true}},"Cells":[{"ChartType":"Boxplot","Target":"Y_id","XDiscrete":"A_id","Column":0},{"ChartType":"Violin plot","Target":"Y_id","XDiscrete":"B_id","Column":1}]},"Data":[{"Name":"Target","Source":"0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.46281933784484863,0.6358867287635803,0.5063204169273376,0.3760460317134857,0.6182591915130615,0.5088015794754028,0.505258321762085,0.5111819505691528,0.46288037300109863,0.4765220582485199,0.5927671194076538,0.3566057085990906,0.569875180721283,0.35384687781333923,0.35959959030151367,0.5634571313858032,0.5850672721862793,0.46569713950157166,0.5441938042640686,0.46799516677856445,0.5769706964492798,0.2971770167350769,0.6825982928276062,0.4416424334049225,0.3867000639438629,0.6435468792915344,0.5585406422615051,0.5409863591194153,0.4781029224395752,0.2601916790008545,0.5534135103225708,0.4577440619468689,0.4876247048377991,0.4126926362514496,0.5962645411491394,0.46882233023643494,0.6743828058242798,0.6267830729484558,0.5137699842453003,0.48627275228500366,0.37014374136924744,0.43829160928726196,0.4803094267845154,0.8072909116744995,0.3293496370315552,0.44329357147216797,0.46786707639694214,0.4642292559146881,0.6790948510169983,0.6479750871658325,0.5961272120475769,0.4746238589286804,0.36909088492393494,0.5186559557914734,0.5823938250541687,0.3911283016204834,0.6217871904373169,0.33185824751853943,0.49166232347488403,0.6515976190567017,0.5822046995162964,0.32423168420791626,0.48655349016189575,0.4289986491203308,0.46805325150489807,0.7426130175590515,0.5773766040802002,0.4814813733100891,0.5197180509567261,0.49393296241760254,0.5720511674880981,0.5023376941680908,0.45022130012512207,0.5953459143638611,0.426203191280365,0.5700246691703796,0.495242178440094,0.5241249203681946,0.49308452010154724,0.2981474995613098","Id":"Y_id","Type":"Trivial"},{"Name":"A","Source":{"Categories":["A","A2","A3","A4"],"Values":"1,3,2,0,1,0,2,2,2,0,1,1,1,3,1,3,3,2,3,0,3,0,2,1,0,2,1,0,2,3,3,2,3,2,1,0,3,3,3,2,3,3,2,1,1,0,1,3,1,0,3,0,2,1,1,3,3,1,1,2,0,3,2,2,0,2,0,2,0,0,2,1,2,1,2,2,2,1,1,0,1,3,0,2,0,0,2,0,3,0,0,3,2,3,1,2,2,2,1,1"},"Id":"A_id","Type":"Trivial"},{"Name":"B","Source":{"Categories":["B1","B2","B3","B4","B5","B6"],"Values":"3,2,0,5,0,0,4,1,1,4,1,1,4,0,5,3,5,1,4,5,5,1,5,3,3,4,4,0,5,0,0,3,4,1,3,0,3,0,2,3,4,2,4,4,5,2,5,3,1,2,0,0,3,4,2,5,0,1,3,5,3,0,4,1,4,2,4,2,1,4,5,3,1,3,5,4,1,0,2,2,1,3,5,0,4,0,1,2,4,3,4,1,3,1,3,3,5,0,0,2"},"Id":"B_id","Type":"Trivial"}]}',
            "Canvas": '{"Chart":{"ChartProperties":{"Domain":"mySAGEChart","Toolbar":{"Show":true},"Width":1700,"Height":1200},"Charts":[{"ChartProperties":{"Toolbar":{"Show":true},"Title":"Lines plot"},"Properties":{"Lines":{"Line":{"Style":"Dash","Scale":4}}},"ChartType":"Lines","CheckBoxFilter":"ColorVarId","Color":"ColorVarId","X":"XVarId","Y":"YVarId"},{"ChartProperties":{"Toolbar":{"Show":true},"Title":"Bubble plot"},"ChartType":"Bubble plot","CheckBoxFilter":"ColorVarId","Color":"ColorVarId","X":"XVarId","Y":"YVarId"},{"ChartProperties":{"Toolbar":{"Show":true},"Title":"Histogram plot","Width":1200,"Height":600},"ChartType":"Histogram","Color":"YVarId","Text":"YVarId","Partition":"ColorVarId","CheckBoxFilter":"ColorVarId","Target":"XVarId"}]},"Data":[{"Name":"X","Source":{"Formatter":{"Type":"CompactTimeFormatter"},"Values":"2410.13916015625,2411.571044921875,2409.270263671875,2413.79052734375,2409.946533203125,2412.364013671875,2411.175537109375,2409.604248046875,2413.190673828125,2410.408203125,2414.421630859375,2411.731201171875,2409.4638671875,2413.051025390625,2410.046630859375,2413.83935546875,2413.00146484375,2414.030029296875,2411.230224609375,2413.487060546875,2411.67724609375,2410.474365234375,2412.29296875,2415.12353515625,2412.0068359375,2415.90283203125,2415.694580078125,2413.08740234375,2408.146240234375,2413.2255859375,2413.036865234375,2412.60986328125,2412.892333984375,2409.743408203125,2414.0615234375,2412.81103515625,2412.6826171875,2410.147216796875,2411.65185546875,2415.703125,2412.593994140625,2415.5185546875,2414.829833984375,2409.18798828125,2413.345947265625,2412.33056640625,2411.7607421875,2412.05810546875,2410.296875,2415.445556640625,2414.748046875,2412.9970703125,2412.447021484375,2413.117431640625,2415.237060546875,2409.57861328125,2413.43701171875,2411.990966796875,2412.813232421875,2415.26806640625,2412.546875,2410.10009765625,2412.203125,2408.419189453125,2411.698974609375,2411.870849609375,2412.273681640625,2411.279296875,2412.455810546875,2413.119384765625,2411.032470703125,2412.984130859375,2413.01953125,2410.052978515625,2412.62744140625,2412.561279296875,2411.23388671875,2412.26806640625,2414.347900390625,2413.927490234375,2413.583251953125,2415.753662109375,2409.623291015625,2412.892333984375,2412.192138671875,2411.8876953125,2413.02294921875,2412.15380859375,2407.825927734375,2412.43994140625,2411.2578125,2412.302001953125,2408.890869140625,2410.570068359375,2412.18017578125,2410.8173828125,2412.433349609375,2411.82861328125,2411.781005859375,2411.06982421875"},"Id":"XVarId","Type":"Trivial"},{"Name":"Y","Source":"0.5480514168739319,0.2870051860809326,0.39954838156700134,0.6271126866340637,0.612295925617218,0.4521470069885254,0.5490585565567017,0.4968932271003723,0.4396648406982422,0.5405193567276001,0.49818411469459534,0.5487715601921082,0.5900692343711853,0.46613365411758423,0.549400269985199,0.2580614686012268,0.44604936242103577,0.6031495332717896,0.40284428000450134,0.6352885365486145,0.46281933784484863,0.6358867287635803,0.5063204169273376,0.3760460317134857,0.6182591915130615,0.5088015794754028,0.505258321762085,0.5111819505691528,0.46288037300109863,0.4765220582485199,0.5927671194076538,0.3566057085990906,0.569875180721283,0.35384687781333923,0.35959959030151367,0.5634571313858032,0.5850672721862793,0.46569713950157166,0.5441938042640686,0.46799516677856445,0.5769706964492798,0.2971770167350769,0.6825982928276062,0.4416424334049225,0.3867000639438629,0.6435468792915344,0.5585406422615051,0.5409863591194153,0.4781029224395752,0.2601916790008545,0.5534135103225708,0.4577440619468689,0.4876247048377991,0.4126926362514496,0.5962645411491394,0.46882233023643494,0.6743828058242798,0.6267830729484558,0.5137699842453003,0.48627275228500366,0.37014374136924744,0.43829160928726196,0.4803094267845154,0.8072909116744995,0.3293496370315552,0.44329357147216797,0.46786707639694214,0.4642292559146881,0.6790948510169983,0.6479750871658325,0.5961272120475769,0.4746238589286804,0.36909088492393494,0.5186559557914734,0.5823938250541687,0.3911283016204834,0.6217871904373169,0.33185824751853943,0.49166232347488403,0.6515976190567017,0.5822046995162964,0.32423168420791626,0.48655349016189575,0.4289986491203308,0.46805325150489807,0.7426130175590515,0.5773766040802002,0.4814813733100891,0.5197180509567261,0.49393296241760254,0.5720511674880981,0.5023376941680908,0.45022130012512207,0.5953459143638611,0.426203191280365,0.5700246691703796,0.495242178440094,0.5241249203681946,0.49308452010154724,0.2981474995613098","Id":"YVarId","Type":"Trivial"},{"Name":"Color","Source":{"Categories":["category1","category2","category3","category4","category5"],"Values":"3,4,3,2,0,2,0,0,0,2,3,0,2,1,2,1,0,0,2,0,1,1,0,1,2,3,1,0,0,3,1,0,0,2,2,2,1,2,1,2,3,3,3,2,2,4,2,1,3,1,4,4,4,0,3,4,4,1,1,4,4,1,3,2,2,4,2,1,3,2,2,3,3,3,0,2,2,0,1,4,3,2,4,4,4,1,4,2,3,0,3,3,0,4,3,1,4,0,4,0"},"Id":"ColorVarId","Type":"Trivial"}]}'
        };
		
        const exampleSelector = document.getElementById('exampleSelector');
        for (const [title, json] of Object.entries(examples)) {
			const option = document.createElement('option');
            option.value = title;
            option.textContent = title;
            exampleSelector.appendChild(option);
        }
        
        exampleSelector.addEventListener('change', function() {
            const selectedExample = this.value;
			if (examples[selectedExample]) {
                jsonEditor.setValue(examples[selectedExample]);
                onBuild(jsonEditor);
            }
        });

        exampleSelector.value = "Canvas";        
        jsonEditor.setValue(examples[exampleSelector.value]);
        //onBuild(jsonEditor); dont call it since SAGE is not ready yet

        document.getElementById('buildButton').addEventListener('click', function () {
            onBuild(jsonEditor);
        });
		
        document.getElementById('overlayButton').addEventListener('click', function() {
            insertJsonNode(jsonEditor, '"Layers": [{}]');
        });

        document.getElementById('tableButton').addEventListener('click', function() {
            insertJsonNode(jsonEditor, '"Cells": [{"Row":0,"Column":0,{}}]');
        });

        document.getElementById('canvasButton').addEventListener('click', function() {
            insertJsonNode(jsonEditor, '"Charts": [{}]');
        });
    });

    function onSAGEInitialized() {
        document.getElementById('buildButton').click(); //SAGE is ready
    }
	
    function onBuild(jsonEditor) {
		const chartContainer = document.getElementById('mySAGEChart');
		console.log('JSON Editor Value:', jsonEditor.getValue()); // Log the value of jsonEditor
        try {
            const jsonData = JSON.parse(jsonEditor.getValue());
			const data = JSON.stringify(jsonData, null, 2)
            if (replaceSAGEChart('mySAGEChart', data) <= 0){
					error = getSAGEError(true);           
					// Display the escaped error message in the chart container
					chartContainer.innerHTML = `<p style="color: red;">${error}</p>`;
			}
			else {
				// everything is fine. Something is loaded.
				chartContainer.innerHTML = ``;
			}
			jsonEditor.setValue(data);
        } catch (e) {
		    loadData("",0)
            console.error('JSON Parsing Error:', e); // Log the exception error to the console
            chartContainer.innerHTML = `<p style="color: red;">Invalid JSON: ${e.message}</p>`;
        }
		
		{//getSAGEJsonValue demo 
			const value = getSAGEJsonValue("Color.Values");
			console.log('Color values:', value);
		}
		
		{//getSAGEValue demo 
			const value = getSAGEValue("Color.Values[5]", false, true);
			console.log('Color values[5]:', value);
		}
    }
		
	function insertJsonNode(jsonEditor, newNode) {
        const doc = jsonEditor.getDoc();
        const cursor = doc.getCursor();
        const selection = doc.getSelection();

        if (selection) {
            // If there is a selection and insertSelection is true, insert the selection into the new node
            const newNodeWithSelection = newNode.replace('{}', `{${selection}}`);
            doc.replaceSelection(newNodeWithSelection);
        } else {
            // If there is no selection, insert at the current cursor position
            const content = doc.getValue();
            const position = cursor.ch;

            if (position) {
                // Insert at the current cursor position
                doc.replaceRange(newNode, cursor);
            } else {
                // Insert before the last } symbol
                const lastBraceIndex = content.lastIndexOf('}');
                if (lastBraceIndex !== -1) {
                    const newContent = content.slice(0, lastBraceIndex) + `, ${newNode}` + content.slice(lastBraceIndex);
                    doc.setValue(newContent);
                } else {
                    // If no } symbol is found, append the new node
                    doc.setValue(content + `, ${newNode}`);
                }
            }
        }
    }
		
    </script>
</body>
</html>